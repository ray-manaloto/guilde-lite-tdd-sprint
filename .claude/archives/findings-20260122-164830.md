# Findings: AI Self-Healing & Autonomous Hooks

## Session: 2026-01-22

### Key Discoveries

#### 1. Environment Configuration
- **Root `.env`**: Contains GITHUB_TOKEN (user added)
- **`backend/.env`**: Needs GITHUB_TOKEN synced (backend reads from here)
- **Singleton issue**: `SelfHealService` caches config at startup
- **uvicorn --reload**: Only watches `.py` files, NOT `.env` files

#### 2. GitHub Integration
- Token authenticates as user `sortakool`
- Workflow file exists locally but is UNTRACKED
- Repository: `ray-manaloto/guilde-lite-tdd-sprint`

#### 3. Existing Hooks (from .claude/settings.json)
```json
{
  "permissions": {
    "allow": [
      "Bash(cd backend && uv run pytest:*)",
      "Bash(cd backend && uv run ruff:*)",
      "Bash(git status:*)", "Bash(git diff:*)", "Bash(git log:*)"
    ]
  },
  "hooks": {
    "PreToolUse": [
      // Block .env edits, lock files, existing migrations
    ],
    "PostToolUse": [
      // Auto-format, type-check, run tests
    ]
  }
}
```

#### 4. Claude Code Hooks System
- **Hook types**: PreToolUse, PostToolUse, UserPromptSubmit, Stop, SubagentStop, SessionStart, PermissionRequest
- **Hookify**: Markdown-based `.claude/hookify.<name>.local.md` rules
- **Plugin**: `claude-md-management` for CLAUDE.md management

#### 5. Autonomous Operation Design
**Tier 1 - Auto-approve (no confirmation):**
- Read, Glob, Grep, WebSearch, WebFetch
- git status/diff/log
- pytest, ruff, mypy, bandit

**Tier 2 - Confirm once per session:**
- Write/Edit (non-sensitive files)
- git add, commit

**Tier 3 - Always confirm:**
- .env files, secrets
- git push --force, reset --hard
- Database migrations
- Service restarts

### Blockers Requiring User Action
1. Backend restart (uvicorn doesn't reload on .env changes)
2. Push workflow to GitHub (if git push fails)
