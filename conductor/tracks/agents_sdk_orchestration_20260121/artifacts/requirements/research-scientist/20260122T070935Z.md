# Requirements: Orchestration Inventory

## Test Scope Check
- `uv run pytest -m integration` selects 0 tests (437 deselected), exit code 5. No integration tests currently tagged.

## Current Orchestration Flow

### Core agent wrapper
- `backend/app/agents/assistant.py`: `AssistantAgent` uses PydanticAI with provider-specific models.
  - OpenAI uses Responses API (`openai-responses:<model>` enforced).
  - Anthropic uses `AnthropicModel` with provider base URL support.
  - Tools: HTTP fetch, agent-browser, filesystem, and CLI delegation (Codex/Claude) toggled by settings.

### Planning interview
- `backend/app/agents/ralph_planner.py`: `run_planning_interview` uses `AssistantAgent`.
  - Supports stub mode, single provider, or dual-subagent (OpenAI + Anthropic) with OpenAI judge.
  - Planning metadata includes trace IDs + judge rationale.
- `backend/app/services/spec.py`: `SpecService.start_planning` stores interview Q/A in DB `Spec.artifacts`.

### TDD multi-agent run
- `backend/app/services/agent_tdd.py`: `AgentTddService.execute` runs subagents in parallel.
  - Uses `AssistantAgent` for each provider; optional dual-subagent mode.
  - Judge uses OpenAI; writes runs/candidates/decisions/checkpoints to DB.
  - Telemetry spans recorded via `app/core/telemetry`.

### API/WebSocket touchpoints
- `backend/app/api/routes/v1/tdd_runs.py`: REST endpoint for AgentTdd runs.
- `backend/app/api/routes/v1/agent.py`: WebSocket streaming; when dual-subagent enabled, uses AgentTddService.

### Orchestration utilities (not fully wired)
- `backend/app/agents/orchestration/`:
  - `PromptDispatcher` supports SDK/CLI/HTTP execution with telemetry hooks.
  - `AgentRegistry` stores agent configs.
  - `CheckpointManager` handles checkpoint snapshots.
  - `TelemetryCollector` supports Logfire/JSONL/Prometheus backends.
  - Currently not referenced by `SpecService`/`AgentTddService`.

### CLI
- `backend/app/commands/spec_runner.py`: `spec-run` CLI creates spec and optional validation; uses DB spec service (not Conductor artifacts).
