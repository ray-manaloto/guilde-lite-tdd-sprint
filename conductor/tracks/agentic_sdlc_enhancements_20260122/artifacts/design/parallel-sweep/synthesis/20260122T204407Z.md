Below is a unified Phase 2 design summary synthesized across UI/UX, context engineering, documentation, and QA automation.

---

# Phase 2 Design Summary

## Key Decisions
- **Parallelized UX pipeline:** UI Designer, UX Researcher, and Accessibility Specialist run in parallel; UI/UX Lead reconciles into a single Phase 2 design packet with annotated specs, acceptance criteria, and a11y guidance.
- **Context-first artifacts:** Maintain `DESIGN_CONTEXT.md` + `NOTES_UX.md` to persist design principles and decisions; integrate deterministic verification checklists per screen/flow.
- **Tiered context model:** Core/Task/Transient tiers with deterministic compaction and recovery flow using fixed artifact paths and schema.
- **Hook-driven doc sync:** Documentation updates are triggered automatically after tool usage and on session end; recovery snapshots are captured and restored on session start.
- **QA scope and stability:** PR smoke gates for critical flows, nightly full E2E with visual/a11y, real integration tests (no mocks), stable selectors, and AI-assisted review/observability.

---

## Conflicts / Resolutions
- **Ownership of context/design artifacts**
  - *Conflict:* No clear owner for `DESIGN_CONTEXT.md`/`NOTES_UX.md`.
  - *Resolution:* Assign UI/UX Lead as owner; add mandatory update checklist at Phase 2 exit.
- **Scope of visual regression**
  - *Conflict:* Unclear minimum set of “no-regression” screens.
  - *Resolution:* Define top 5 critical surfaces now; expand later based on usage metrics.
- **Strictness of UX Acceptance Gate**
  - *Conflict:* How strict for low‑risk/experimental features.
  - *Resolution:* Two-tier gate: “Required” for core flows, “Advisory” for experiments.
- **Hook reliability vs developer loop speed**
  - *Conflict:* Aggressive automation may slow iteration.
  - *Resolution:* Keep heavy tests in PR/nightly gates; hooks remain lightweight (doc sync + logging).
- **AI review enforcement**
  - *Conflict:* Advisory vs merge‑blocking.
  - *Resolution:* Advisory in Phase 2, with human spot‑checks; revisit after calibration.

---

## Hooks / Automation
- **Context engineering**
  - `PreToolUse`: enforce allowed tools & file paths.
  - `PostToolUse`: log to work log.
  - `PreCompact`: deterministic compaction into `DECISIONS.md`, `PLAN.md`, `RISKS.md`.
  - Evaluator loop on `PLAN.md`/`SPEC.md` before execution.
- **Documentation**
  - `PostToolUse`: doc sync trigger.
  - `Stop/SubagentStop`: completion checks.
  - `SessionEnd`: snapshotter (git status + diff + last outputs).
  - `SessionStart`: restore snapshot + recovery instructions.
  - `PreCompact`: recovery note.
  - Operator commands: `/sync-docs`, `/sync-plan`, `/recovery-status`.
- **QA automation**
  - Hook‑driven lint/format/unit smoke.
  - E2E smoke on PR; full suite nightly with visual/a11y.

---

## QA Gates
- **PR Gate (Required)**
  - Lint/format + unit smoke
  - E2E smoke (login, sprint creation, plan run)
  - Integration subset (critical service paths)
  - AI reviewer summary posted to PR
- **Nightly Gate (Required for release readiness)**
  - Full E2E + visual regression + a11y
  - Full integration tests
  - AI observability summary
- **UX/A11y Gates**
  - UX Acceptance Gate: acceptance criteria + verification checklist for all critical journeys
  - A11y Gate: WCAG 2.1 AA checklist + violations documented
  - Visual Consistency Gate: snapshot approvals for key surfaces
- **Context Gates**
  - Compaction determinism (hash match)
  - Recovery replay (plan checksum match)
  - Guardrail enforcement (blocked writes logged)
  - Evaluator gate before execution

---

## Next Steps
1. **Define ownership + cadence** for `DESIGN_CONTEXT.md` and `NOTES_UX.md`.
2. **Finalize “no‑regression” surface list** and minimum visual regression scope.
3. **Lock critical flows** for PR smoke gate beyond login/sprint/plan run.
4. **Approve compaction schema** and implement hook contracts.
5. **Enable doc sync commands** and update CLAUDE.md with required workflow.
6. **Set thresholds**: token budget for `PreCompact`, flake‑rate policy for test quarantine.
7. **Decide AI reviewer policy**: advisory now, revisit enforcement after calibration window.

---