# Design Notes (qa-gates)

## Goals
- Enforce fast PR smoke gates without slowing the inner loop.
- Run full regression coverage nightly.
- Follow pytest and PEP standards for test structure.

## PR Smoke Gate (Required)
Backend (FastAPI):
- `cd backend && uv run pytest -m integration`
  - Integration tests must avoid mocks/patch fixtures.
- `cd backend && uv run ruff check . --fix && uv run ruff format .` (if not already enforced).

Frontend (Next.js + Playwright):
- `cd frontend && bun run lint`
- `cd frontend && bun run type-check`
- `cd frontend && bun run test:e2e --grep @smoke`
  - Tag critical flows with `@smoke` in Playwright specs.

## Nightly Gate (Required for release readiness)
Backend:
- `cd backend && uv run pytest`
- `cd backend && uv run pytest -m integration`

Frontend:
- `cd frontend && bun run test:e2e`
- `cd frontend && bun run test:run`

Optional nightly add-ons:
- Visual regression snapshots for key screens.
- A11y checks for core flows.

## Test Taxonomy (pytest best practices)
- Add markers in `backend/pyproject.toml`:
  - `integration` (already)
  - `e2e`
  - `smoke`
  - `nightly`
- Use `pytest.mark.integration` for real dependency tests.
- Use fixtures for test data setup; avoid shared mutable state.
- PEP alignment:
  - PEP 8 style, PEP 257 docstrings for complex fixtures.
  - PEP 484 typing for helper utilities where clarity helps.

## Smoke Flow Coverage (initial)
- Authentication flow
- Sprint creation + plan run
- Core planning interview flow
- CLI-driven deep research invocation (happy path)

## Reporting
- Store smoke/nightly reports under `conductor/tracks/<id>/artifacts/qa/<timestamp>.md`.
- Include pass/fail summary and links to logs or Playwright reports.

## Sources
- `conductor/tracks/agentic_sdlc_enhancements_20260122/research.md`
- `backend/pyproject.toml`
- `frontend/package.json`
