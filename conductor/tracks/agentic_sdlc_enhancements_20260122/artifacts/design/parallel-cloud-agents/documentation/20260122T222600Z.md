## Design Decisions
- **Doc subagent trigger points:** Run after `Spec` and `Plan` stages, and on `Implement` completion, to produce documentation diffs only (no full files). Tie invocations to Conductor artifact updates (`spec.md`, `plan.md`) to avoid drift.
- **Canonical source alignment:** Conductor artifacts remain source of truth. Doc subagent consumes minimal context (artifact sections + change summary) and returns patch/diff to apply.
- **Recovery practices:** If a doc run fails, retry with bounded concurrency and short timeouts; on repeated failure, emit a “recovery note” diff that logs the failure in `plan.md` under a **Documentation Recovery** subsection.
- **Isolation + secrets:** Doc subagent runs in sandboxed compute (Lambda/Fargate), no access to prod data; any needed secrets pulled via Secrets Manager with rotation; no hardcoded credentials.

## Deliverables
- **Doc diff patches** targeting:
  - `spec.md`: update “Documentation Requirements” or “Change Log” sections.
  - `plan.md`: add/update “Documentation Tasks” and “Documentation Recovery” subsections.
- **Doc run report** appended to workflow logs (not artifacts) with token usage and retries.
- **Recovery note template** (minimal) for failed runs inserted into `plan.md`.

## Gates
- **Spec Gate:** Doc subagent produces `spec.md` diff; pipeline blocks if diff is empty and spec changed.
- **Plan Gate:** Doc subagent updates `plan.md` tasks; block if plan changes without doc tasks.
- **Verify Gate:** Doc subagent emits final doc diff and “recovery note” if needed; must be applied before Verify sign‑off.

## Risks/Dependencies
- **Risk:** Divergence if doc subagent runs on stale artifacts.  
  **Mitigation:** Require latest Conductor artifact hashes as inputs; reject mismatches.
- **Risk:** Over‑documentation duplication.  
  **Mitigation:** Diff‑only outputs; update existing sections, don’t add new top‑level sections unless required.
- **Dependency:** Conductor artifact store + patch application mechanism.
- **Dependency:** Observability (CloudWatch/OTel) for retry/loop detection.

## Open Questions
- Which section(s) in `spec.md`/`plan.md` are designated for doc updates (need canonical headings)?
- Who approves doc diff application (auto‑merge vs. human gate)?
- Required SLA for doc recovery note insertion on failure (immediate vs. next run)?