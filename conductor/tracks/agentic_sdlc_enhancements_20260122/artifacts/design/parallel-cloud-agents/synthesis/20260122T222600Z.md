# Adoption Synthesis Report (Conductor + Cloud Subagents)

## Recommended workflow changes
- **Adopt Conductor-first artifacts**: `spec.md`/`plan.md` remain canonical; all subagents return **unified diffs/patches only** with brief summaries.
- **Event-driven orchestration**: Trigger subagents from Conductor state changes via **EventBridge → Step Functions**, with **SQS backpressure** and concurrency caps.
- **Stage-specific subagents**:
  - **Plan**: Research/review subagents (context-engineering).
  - **Spec/Plan/Verify**: Documentation diffs and recovery notes.
  - **Verify**: QA runners (unit/integration/e2e) producing `verify-report.md` + JSON summary.
- **Patch-application pipeline**: Automated apply/validate of diffs; reject if patch fails or touches non-target files.

## Required cloud agent interfaces & artifact formats
- **Context bundle (input)**: Minimal excerpt + objective + constraints; stored via Conductor artifacts. Template required (`/context/templates/subagent_context.md`).
- **Output (required)**:
  - **Unified diff** targeting `spec.md`/`plan.md` only.
  - **Summary** (short).
  - **QA**: `verify-report.md` + machine-readable JSON summary.
- **Artifact exchange**: Store diffs in **S3**, merge step writes back to Conductor artifacts.

## Security / Observability / Cost guardrails
- **Security**
  - Private subnets + VPC endpoints (S3/Secrets Manager), no public egress by default.
  - Least-privilege IAM per agent; **Secrets Manager** only.
  - Enforce “diff-only” outputs; no direct repo writes.
- **Observability**
  - CloudWatch logs + X-Ray/OTel traces.
  - Emit token usage, runtime, loop detection, Conductor task ID mapping.
- **Cost**
  - Reserved concurrency caps; SQS backpressure.
  - Budgets + anomaly detection; tagging by `agent`, `repo`, `run_id`.
  - Lambda for short tasks; Fargate (spot optional) for long tasks with timeouts.

## Do-not-adopt (Conductor conflicts)
- **No standalone docs or full-file outputs** from subagents (diff-only).
- **No direct repo writes** by agents; only patch pipeline applies changes.
- **No PydanticAI usage**; use OpenAI Agents SDK + LiteLLM for Anthropic (per constraints).
- **No full-repo context dumps** to subagents; use minimal context bundles.

## Next steps
1. **Confirm open questions**: Fargate vs Lambda thresholds; test suite requirements; patch application owner; token/context limits; IaC preference (CDK/Terraform).
2. **Implement infra modules**: Step Functions, EventBridge, SQS, VPC endpoints, IAM, budgets/alerts, CloudWatch/X-Ray.
3. **Define Conductor tasks**: `SubagentResearchTask`, `SubagentReviewTask`, `DocSubagentTask`, `QASubagentTask` with I/O schemas.
4. **Ship patch pipeline**: Diff validation, versioning, conflict resolution, linting gates.
5. **Add gates**: Security, cost, observability, spec/plan consistency, verify suite pass.