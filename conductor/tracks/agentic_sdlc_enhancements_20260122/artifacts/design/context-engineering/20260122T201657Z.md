# Design Notes (context-engineering)

## Goals
- Preserve critical decisions across long sessions.
- Keep agent context focused on active work.
- Provide deterministic recovery after terminal crashes.

## Context Tiers
1. **Core (always load)**
   - `conductor/product.md`, `conductor/tech-stack.md`, `conductor/workflow.md`, `conductor/tracks.md`.
   - Active track: `spec.md`, `plan.md`, latest `research.md`.
2. **Task (load per task)**
   - Files touched in current task, relevant tests, current diffs.
   - Any open questions or blockers for the task.
3. **Transient (ephemeral)**
   - Scratch notes, tool outputs, and short-lived experiments.

## Compaction Rules
- Trigger compaction when:
  - Context exceeds ~70% usage, or
  - Task or phase completes.
- Compaction output stored at:
  - `conductor/tracks/<id>/artifacts/context/<timestamp>.md`
  - Include: decisions, next steps, open questions, file paths, verification status.

## Recovery Flow
1. Load Core tier on session start.
2. Load most recent context artifact (if present).
3. Reconcile with plan:
   - Mark in-progress tasks.
   - Confirm verification status.
4. Re-run minimal checks (e.g., `git status -sb`, latest test command).

## Guardrails
- Do not discard: spec/plan deltas, hook config, env changes, QA gate outcomes.
- Always add new artifacts rather than overwrite unless explicitly forced.
- Maintain a “Do Not Forget” section in each context artifact.

## Tooling Hooks
- Use a hook to remind/require context artifact updates at phase boundaries.
- Require deep research artifact for any research-tagged task.

## Sources
- `conductor/tracks/agentic_sdlc_enhancements_20260122/research.md`
